<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>SB Admin 2 - Dashboard</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <!-- Custom fonts for this template-->
    <link href="../vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link
        href="https://fonts.googleapis.com/css?family=Nunito:200,200i,300,300i,400,400i,600,600i,700,700i,800,800i,900,900i"
        rel="stylesheet">

    <!-- Custom styles for this template-->
    <link href="../css/sb-admin-2.min.css" rel="stylesheet">
    <link href="../css/toggle-switch.css" rel="stylesheet">

</head>

<body>

    <div class="container-fluid">

        <!-- Page Heading -->
        <div class="d-sm-flex align-items-center justify-content-between mb-4">
            <h1 class="h3 mb-0 text-gray-800">지점 추가</h1>
        </div>


        <!-- Content Row -->

        <div class="row">

            <div class="col-xl-4">
                <div class="card shadow mb-4">
                    <!-- Card Header - Dropdown -->
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">지점 사진</h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            </a>
                        </div>
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div id="nophoto">
                            <input style="width:100%; height:50px; background:transparent; border : solid 1px;"
                                type='file' value='upload' id='filee' onchange='addPhoto(event)' name='file'>
                            <!-- <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" onclick="addPhoto()"> -->
                            <!-- <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm" onclick="window.open('add_branch.html', 'blank', 'width=1600 height = 900')"> -->
                            <i class="fas fa-download fa-sm text-white-50"></i> 지점 사진 추가</a>
                        </div>
                        <div id="yesphoto">
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-8">
                <div class="card shadow mb-4">
                    <!-- Card Header - Dropdown -->
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">운영자 정보</h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            </a>
                        </div>
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead></thead>
                                <tbody>
                                    <tr>
                                        <th>지점명</th>
                                        <td><input id="branchName" value="숭실대점" type="text"></td>
                                        <th>운영자</th>
                                        <td><input type="text"></td>
                                        <th>주민번호</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>연락처</th>
                                        <td><input type="text"></td>
                                        <th>이메일</th>
                                        <td><input type="text"></td>
                                        <th>계좌번호</th>
                                        <td><input type="text"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div class="row">

            <div class="col-xl-4">
                <div class="card shadow mb-4">
                    <!-- Card Header - Dropdown -->
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">지출 정보</h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            </a>
                        </div>
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead></thead>
                                <tbody>
                                    <tr>
                                        <th>월세</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>초기 고정비</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>부동산 중개 수수료</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>인테리어</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>수도</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>가스</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>전기</th>
                                        <td><input type="text"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>

            <div class="col-8">
                <div class="card shadow mb-4">
                    <!-- Card Header - Dropdown -->
                    <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                        <h6 class="m-0 font-weight-bold text-primary">지점 정보</h6>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            </a>
                        </div>
                    </div>
                    <!-- Card Body -->
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                <thead></thead>
                                <tbody>
                                    <tr>
                                        <th>주소</th>
                                        <td colspan="3"><input type="text"></td>
                                        <th>비밀번호</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>운영 기간</th>
                                        <td colspan="3"><input type="text"></td>
                                        <th>WIFI</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>입주 성별</th>
                                        <td><input type="text"></td>
                                        <th>입주 정원</th>
                                        <td><input type="text"></td>
                                        <th>입주가능일</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>주택 유형</th>
                                        <td><input type="text"></td>
                                        <th>해당층/건물층</th>
                                        <td><input type="text"></td>
                                        <th>공급 면적</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>입주 조건</th>
                                        <td><input type="text"></td>
                                        <th>입주 제한</th>
                                        <td><input type="text"></td>
                                        <th>옵션 설정</th>
                                        <td><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>관리비 포함 내용</th>
                                        <td colspan="5"><input type="text"></td>
                                    </tr>
                                    <tr>
                                        <th>제공 서비스</th>
                                        <td colspan="5"><input type="text"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="col-xl-12">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">방 정보</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        </a>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-bordered" id="dataTable_room" width="100%" cellspacing="0">
                            <thead>
                                <button onclick="add_room()">방 추s가</button>
                            </thead>
                            <tbody id="11">
                                <tr>
                                    <th><input type="checkbox"></th>
                                    <th>이름</th>
                                    <th>정보</th>
                                    <th>타입</th>
                                    <th>보증금</th>
                                    <th>월세</th>
                                    <th>공과금</th>
                                    <th>관리비</th>
                                    <th>할인프로모션</th>
                                    <th>입주가능상태</th>
                                    <th>입주가능일</th>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-xl-12">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">관리 정보</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                        </a>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div class="row">
                        <div class="col-xl-2">
                            매니저 사진
                        </div>
                        <div class="col-xl-10">

                        </div>
                    </div>
                </div>
            </div>
        </div>





    </div>
    <!-- /.container-fluid -->

    <button onclick="add_branch();" style="width:100%">지점 추가</button>
    </div>
</body>
<script src="https://www.gstatic.com/firebasejs/5.8.5/firebase.js"></script>
<script>
    var branchname = $("#branchName").val();
    console.log(branchname);
    // Initialize Firebase
    var config = {
        apiKey: "AIzaSyBHRFaqMB3j0nIQvRfEHKSfB0O2oDBbMQM",
        authDomain: "famhouse.firebaseapp.com",
        databaseURL: "https://famhouse.firebaseio.com",
        projectId: "famhouse",
        storageBucket: "famhouse.appspot.com",
        messagingSenderId: "864101396642"
    };
    firebase.initializeApp(config);

    var dataref = firebase.database().ref();
    globalfile = "";

    var addPhoto = function (event) {
        var output = document.getElementById('filee');
        console.log(event.target.files[0])
        var file = event.target.files[0];
        console.log(file);
        globalfile = file;

        fileName = branchName;
        let storage = firebase.storage().ref(branchname + `/${fileName}`)
        storage.put(globalfile)
            .then(d => {
                console.log('you did it')
                storage.getDownloadURL().then((url) => {
                    console.log("url url " + url);
                    $("#nophoto").attr("style", "display:none")
                    $("#yesphoto").attr("style", "display:block")
                    $("#yesphoto").append("<img style='width:100%; height:100%;' src=" + url + "/>")
                    dataref.child(branchname).update({ "photourl": url });
                });
            })
            .catch(d => console.log("do something"))

        // output.src = URL.createObjectURL(event.target.files[0]);
    };
    dataref.child(branchname).once('value').then((snapshot) => {
        console.log(snapshot.val().photourl);
        var photo = snapshot.val().photourl;
        if (photo != null) {
            $("#nophoto").attr("style", "display:none")
            $("#yesphoto").attr("style", "display:block")
            //
            $("#yesphoto").append("<img style='width:100%; height:100%;' src=" + photo + "/>")
        } else {
            $("#nophoto").attr("style", "display:block")
            $("#yesphoto").attr("style", "display:none")
        }

    });
    console.log(dataref);
    function add_room() {
        $("#11").append("<tr><th><input type='checkbox'></th><th><input type='text' class='roomname'></th> + <th><input class='roominfo' type='text'></th> + <th><input class='roomtype' type='text'></th> " +
            "<th><input class='roompayment' type='text'></th> + <th><input class='roomMonthlyPayment type='text'></th> + <th>" +
            "<input class='roomUtility' type='text'></th> + <th><input class='roomManagementPayment' type='text'></th> " +
            "<th><input class='roomPromotion' type='text'></th> + <th><label class='switch'><input type='checkbox' checked><span class='slider round'></span></th>+ " +
            "<th><input class='roomDateOfMove' type='text' class='ss'></th>")
    }
    function add_branch() {
        var roomname = document.getElementsByClassName("roomname");
        var roominfo = document.getElementsByClassName("roominfo");
        var roomtype = document.getElementsByClassName("roomtype");

        var roompayment = document.getElementsByClassName("roompayment");
        var roomMonthlyPayment = document.getElementsByClassName("roomMonthlyPayment");
        var roomUtility = document.getElementsByClassName("roomUtility");

        var roomManagementPayment = document.getElementsByClassName("roomManagementPayment");
        var roomPromotion = document.getElementsByClassName("roomPromotion");
        var roomAvailable = document.getElementsByClassName("roomAvailable");
        var roomDateOfMove = document.getElementsByClassName("roomDateOfMove");
        var roomarray = [];
        var roomModel = { "name": "test" }
        var branchname = $("#branchName").val();
        console.log(branchname);
        console.log(roomModel.name);
        for (var i = 0; i < roomname.length; i++) {
            dataref.child(branchname).child("roomInfo").child(roomname[i].value).update({ "name": roomname[i].value, "info": roominfo[i].value, "type": roomtype[i].value, "payment": roompayment[i].value, monthlypayment: roomMonthlyPayment[i].value, "utility": roomUtility[i].value, "management": roomManagementPayment[i].value, "promotion": roomPromotion[i].value, "available": roomAvailable[i].value, "dateofmove": roomDateOfMove[i].value })
        }


    }
</script>